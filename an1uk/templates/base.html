<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}an1uk{% endblock %}</title>
    <meta name="description" content="an1uk - Reselling and automation platform">
    <meta name="theme-color" content="#212529">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700&display=swap" rel="stylesheet">
    <style>
        html, body { height: 100%; margin: 0; padding: 0; }
        body {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            font-family: 'Montserrat', Arial, sans-serif;
            background-color: #f8f9fa;
            transition: background 0.2s, color 0.2s;
        }
        .main-content {
            flex: 1 0 auto;
            display: flex;
            flex-direction: column;
        }
        .footer {
            flex-shrink: 0;
        }
        .main-content > *:first-child { margin-top: 0 !important; }
        .navbar-light {
            background-color: #fff !important;
            border-bottom: 1px solid #e0e0e0;
            box-shadow: 0 1px 6px 0 rgba(0,0,0,0.07), 0 1.5px 4px 0 rgba(0,0,0,0.03);
        }
        .navbar-light .navbar-brand,
        .navbar-light .nav-link {
            color: #222 !important;
        }
        .navbar-light .nav-link.active,
        .navbar-light .nav-link:focus,
        .navbar-light .nav-link:hover {
            color: #0056b3 !important;
        }
        .dark-mode {
            background-color: #181a1b !important;
            color: #f8f9fa !important;
        }
        .dark-mode .navbar-light {
            background-color: #23272b !important;
            border-bottom: 1px solid #16191c;
            box-shadow: none;
        }
        .dark-mode .navbar-light .navbar-brand, 
        .dark-mode .navbar-light .nav-link {
            color: #f8f9fa !important;
        }
        .dark-mode .navbar-light .nav-link.active,
        .dark-mode .navbar-light .nav-link:focus,
        .dark-mode .navbar-light .nav-link:hover {
            color: #90caf9 !important;
        }
        .dark-mode .bg-white {
            background-color: #22282e !important;
            color: #f8f9fa !important;
        }
        .dark-mode .alert {
            background-color: #263238;
            color: #fff;
            border-color: #222;
        }
        .dark-mode .footer {
            background-color: #23272b !important;
            color: #f8f9fa !important;
        }
        #modeToggle .mode-icon {
            font-size: 1.25em;
            vertical-align: middle;
            margin-right: 0.45em;
            margin-bottom: 0.1em;
        }
    </style>
    {% block styles %}{% endblock %}
</head>
<body>
<nav id="navbar" class="navbar navbar-expand-lg navbar-light">
  <div class="container-fluid">
    <a class="navbar-brand" href="/">an1uk</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
      aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        {% if current_user.is_authenticated %}
          <li class="nav-item">
            <a class="nav-link disabled" tabindex="-1" aria-disabled="true">
              <i class="bi bi-person-circle"></i> {{ current_user.username }}
            </a>
          </li>
          <li class="nav-item"><a class="nav-link" href="{{ url_for('auth.logout') }}">Logout</a></li>
        {% else %}
          <li class="nav-item"><a class="nav-link" href="{{ url_for('auth.login') }}">Login</a></li>
        {% endif %}
        <li class="nav-item ms-2">
          <button id="modeToggle" class="btn btn-sm btn-outline-secondary d-flex align-items-center" type="button">
            <i class="mode-icon bi bi-circle-half" id="modeToggleIcon"></i>
            <span id="modeToggleText">Auto</span>
          </button>
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="main-content">
  <div class="container-fluid px-0 h-100">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="mt-3">
          {% for category, message in messages %}
            <div class="alert alert-{{ category if category else 'info' }} alert-dismissible fade show" role="alert">
              {{ message }}
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}
    <div class="p-3 m-0 bg-white rounded shadow-sm h-100">
      {% block content %}{% endblock %}
    </div>
  </div>
</div>

<footer class="footer bg-dark text-light py-2 text-center small">
  &copy; {{ current_year or '' }} an1uk &mdash; Powered by Flask &amp; Bootstrap
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"></script>
<script>
(function() {
  const body = document.body;
  const navbar = document.getElementById('navbar');
  const modeToggle = document.getElementById('modeToggle');
  const modeToggleText = document.getElementById('modeToggleText');
  const modeToggleIcon = document.getElementById('modeToggleIcon');

  // Mode definitions with Bootstrap Icons
  const modes = [
    { key: 'auto', text: 'Auto', icon: 'bi-circle-half' },
    { key: 'light', text: 'Light', icon: 'bi-sun' },
    { key: 'dark', text: 'Dark', icon: 'bi-moon' }
  ];

  function getSavedMode() {
    return localStorage.getItem('themeMode') || 'auto';
  }
  function applyMode(mode) {
    let effectiveMode = mode;
    if (mode === 'auto') {
      effectiveMode = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    }
    if (effectiveMode === 'dark') {
      body.classList.add('dark-mode');
      navbar.classList.remove('navbar-light');
      navbar.classList.add('navbar-light');
    } else {
      body.classList.remove('dark-mode');
      navbar.classList.remove('navbar-light');
      navbar.classList.add('navbar-light');
    }
    // Update button icon and text
    const active = modes.find(m => m.key === mode);
    if (modeToggleText && modeToggleIcon && active) {
      modeToggleText.textContent = active.text;
      modeToggleIcon.className = 'mode-icon bi ' + active.icon;
    }
  }
  // On load
  let mode = getSavedMode();
  applyMode(mode);

  // Listen for system change if in auto
  if (mode === 'auto') {
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
      if (getSavedMode() === 'auto') applyMode('auto');
    });
  }
  // Toggle on click
  if (modeToggle) {
    modeToggle.addEventListener('click', () => {
      let current = getSavedMode();
      let idx = modes.findIndex(m => m.key === current);
      let next = modes[(idx + 1) % modes.length].key;
      localStorage.setItem('themeMode', next);
      applyMode(next);
    });
  }
})();
</script>
{% block scripts %}{% endblock %}
</body>
</html>
